<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}"
      lang="en">
<head>
    <title>My Notes</title>
</head>
<body>
<div>
    <section layout:fragment="content">
        <div class="container" th:if="${#lists.isEmpty(notes)}"
             style="background:white; opacity: 0.7; overflow-y: auto">
            <h3> You didn't create any note </h3>
            <p><a class="btn btn-secondary" href="/notes/create">Create note</a></p>
        </div>
        <div class="container" th:if="${not #lists.isEmpty(notes)}"
             style="background:white; opacity: 0.7; overflow-y: auto">
            <h3>
                My notes - <span th:text="${notes.size()}"></span> pcs.
            </h3>
            <form action="/notes/create" method="GET">
                <button type="submit" class="btn btn-primary">
                    Create note
                </button>
            </form>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Content</th>
                    <th>Access</th>
                    <th colspan="3" style="width:15%; max-width:200px; text-align:center">Notes managing</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="note : ${notes}">
                    <td th:text="${note.name}"></td>
                    <td th:text="${note.category}"></td>
                    <td th:text="${note.content}"
                        style="max-width:150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis"></td>
                    <td th:text="${note.accessType}"></td>
                    <td colspan="3" style="display:flex; justify-content:space-around; max-width:200px">
                        <button class="btn btn-light" title="Delete"
                              th:attr="onclick=|makeDELETErequest('/notes/${note.id}')|">
                            <img src="/icons/trash.png" alt="deleteButton"
                                 style="border:0; width:30px; height:30px"/>
                        </button>
                        <a class="btn btn-light" title="Edit" 
                              th:href="@{/notes/{id}(id=${note.id})}">
                            <img src="/icons/edit.png"
                                 alt="editButton"
                                 style="border:0; width:30px; height:30px"/></a>
                        <button class="btn btn-light" title="Copy link"
                                type="submit" th:attr="onclick=|copy('/${note.id}')|">
                            <img src="/icons/link-alt.png" alt="copyLinkButton"
                                 style="border:0; width:30px; height:30px"/>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>

<script layout:fragment="script">
    function copy(id) {
        // var copiedtext = document.getElementById(id);
        // copiedtext.select();
        // copiedtext.setSelectionRange(0, 99999); //for mobile devices
        navigator.clipboard.writeText(window.location.href + id);
        alert("You just copied " + window.location.href + id);
    }

    function makeDELETErequest(urlParametr) {
        if (confirm('Are you sure you want to delete this?')) {
            $.ajax({
                url: urlParametr,
                type: 'DELETE',
                success: function () {
                    location.reload();
                },
                error: function (jqXHR, data, textStatus, errorThrown) {

                }
            });
        }
    }
</script>

</body>
</html>
